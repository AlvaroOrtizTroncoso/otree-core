language: python
python: 2.7
install:
  - python setup.py install

  # Setup integration tests.
  - git clone https://github.com/oTree-org/oTree.git otree-lib
  - virtualenv otree-lib/.env --no-site-packages
  - otree-lib/.env/bin/pip install -r otree-lib/requirements_base.txt
  - otree-lib/.env/bin/pip install "psycopg2==2.5.1"
  - otree-lib/.env/bin/python setup.py install

  # install psycopg2 only for travis build, since we don't want to make psycopg2 a requirement for local development
  - pip install psycopg2
before_script:
  - psql -c 'create database travis_ci_test;' -U postgres
script:
  - python runtests.py
  - sh -c 'export DATABASE_URL=postgres://postgres@localhost/travis_ci_test && cd otree-lib && .env/bin/python ./otree recreate && .env/bin/python ./otree test_all'
