

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>views.py &mdash; pTree 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pTree 0.1 documentation" href="../index.html" />
    <link rel="up" title="Writing a ptree app" href="index.html" />
    <link rel="next" title="The templates/ directory" href="templates.html" />
    <link rel="prev" title="forms.py" href="forms.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="templates.html" title="The templates/ directory"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="forms.html" title="forms.py"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">pTree 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Writing a ptree app</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="views-py">
<h1>views.py<a class="headerlink" href="#views-py" title="Permalink to this headline">¶</a></h1>
<p>A View defines a single web page that is shown to participants.
It is implemented as a Python class &#8211; more specifically, a Django <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/class-based-views/generic-display/">class-based view</a>.</p>
<p>For example, if your experiment involves showing the participant a sequence of 5 pages,
your views.py should contain 5 View classes.</p>
<p>When a participant visits your site, they are routed through your views in the order you specify in your treatment&#8217;s <tt class="docutils literal"><span class="pre">sequence_of_views()</span></tt> method.</p>
<p>The participant must submit a valid form before they get routed to the next page.
If the form they submit is invalid (e.g. missing or incorrect values),
it will be re-displayed to them along with the list of errors they need to correct.</p>
<p>Here is what the code of a View should define (along with what attribute/method defines it):</p>
<p>In your view code, ptree automatically provides you with attributes called
<tt class="docutils literal"><span class="pre">participant</span></tt>, <tt class="docutils literal"><span class="pre">match</span></tt>, <tt class="docutils literal"><span class="pre">treatment</span></tt>, and <tt class="docutils literal"><span class="pre">experiment</span></tt>,
so that you can access the current participant, match, treatment, and experiment objects,
and get/set fields or call those objects&#8217; methods.</p>
<div class="section" id="updateview">
<h2>UpdateView<a class="headerlink" href="#updateview" title="Permalink to this headline">¶</a></h2>
<p>Most of the time, your view class will inhert from <tt class="docutils literal"><span class="pre">ptree.views.UpdateView</span></tt>.</p>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="provided-for-you">
<h4>Provided for you<a class="headerlink" href="#provided-for-you" title="Permalink to this headline">¶</a></h4>
<div class="section" id="participant">
<h5>participant<a class="headerlink" href="#participant" title="Permalink to this headline">¶</a></h5>
<p>The current participant.</p>
</div>
<div class="section" id="match">
<h5>match<a class="headerlink" href="#match" title="Permalink to this headline">¶</a></h5>
<p>The current match.</p>
</div>
<div class="section" id="treatment">
<h5>treatment<a class="headerlink" href="#treatment" title="Permalink to this headline">¶</a></h5>
<p>The current treatment.</p>
</div>
<div class="section" id="experiment">
<h5>experiment<a class="headerlink" href="#experiment" title="Permalink to this headline">¶</a></h5>
<p>The current experiment.</p>
</div>
</div>
<div class="section" id="required">
<h4>Required<a class="headerlink" href="#required" title="Permalink to this headline">¶</a></h4>
<div class="section" id="template-name">
<h5>template_name<a class="headerlink" href="#template-name" title="Permalink to this headline">¶</a></h5>
<p>The name of the HTML template to display.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># This will look inside your app under the &#39;templates&#39; directory, to &#39;/app_name/MyView.html&#39;</span>
<span class="n">template_name</span> <span class="o">=</span> <span class="s">&#39;app_name/MyView.html&#39;</span>

<span class="c"># This will use the ptree built-in &#39;Start&#39; template</span>
<span class="n">template_name</span> <span class="o">=</span> <span class="s">&#39;ptree/Start.html&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="form-class">
<h5>form_class<a class="headerlink" href="#form-class" title="Permalink to this headline">¶</a></h5>
<p>The form to display on this page.
Usually this will be the name of a form class defined in your <tt class="docutils literal"><span class="pre">forms.py</span></tt>.
(See <a class="reference internal" href="forms.html#forms"><em>forms.py</em></a> for more info.)</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">form_class</span> <span class="o">=</span> <span class="n">app_name</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">MyForm</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h4>Provided for you<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="section" id="time-limit-was-exceeded-boolean">
<h5>time_limit_was_exceeded: boolean<a class="headerlink" href="#time-limit-was-exceeded-boolean" title="Permalink to this headline">¶</a></h5>
<p>Only available on POST (i.e., after the user submits the form).
Indicates whether the participant exceeded the time limit specified in <tt class="docutils literal"><span class="pre">time_limit_seconds()</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="optional">
<h4>Optional<a class="headerlink" href="#optional" title="Permalink to this headline">¶</a></h4>
<div class="section" id="variables-for-template">
<h5>variables_for_template()<a class="headerlink" href="#variables-for-template" title="Permalink to this headline">¶</a></h5>
<p>Get any variables that will be passed to the HTML template.
Add them to the dictionary as key-value pairs.
(You don&#8217;t need to include the form; that will be handled automatically)</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">variables_for_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;CHARITY&#39;</span><span class="p">:</span> <span class="n">CHARITY</span><span class="p">,</span>
            <span class="s">&#39;is_hypothetical&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="o">.</span><span class="n">probability_of_honoring_split_as_fraction</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&#39;max_offer_amount&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="o">.</span><span class="n">max_offer_amount</span><span class="p">,</span>
            <span class="s">&#39;participant_gets_all_money_if_no_honor_split&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="o">.</span><span class="n">participant_gets_all_money_if_no_honor_split</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="show-skip-wait">
<h5>show_skip_wait()<a class="headerlink" href="#show-skip-wait" title="Permalink to this headline">¶</a></h5>
<p>Whether this view should be shown, skipped, or whether the participant has to wait.
Default behavior is to show the page.</p>
<p>In the case where the participant has to wait, he is redirected to a waiting page
that will make an AJAX call to this method every N seconds.
The participant will have to wait until this method returns Show or Skip.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">show_skip_wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">participant</span><span class="o">.</span><span class="n">open_envelope</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PageActions</span><span class="o">.</span><span class="n">wait</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PageActions</span><span class="o">.</span><span class="n">show</span>
</pre></div>
</div>
</div>
<div class="section" id="wait-message">
<h5>wait_message()<a class="headerlink" href="#wait-message" title="Permalink to this headline">¶</a></h5>
<p>The message to display to users on the waiting page.
(See <tt class="docutils literal"><span class="pre">show_skip_wait()</span></tt>).</p>
</div>
<div class="section" id="after-valid-form-submission">
<h5>after_valid_form_submission()<a class="headerlink" href="#after-valid-form-submission" title="Permalink to this headline">¶</a></h5>
<p>After the participant submits the form,
ptree makes sure that it has all the required values
(and re-displays to the participant with errors otherwise).</p>
<p>Here you can put anything additional that should happen after the form validates.
If you don&#8217;t need anything to be done, it&#8217;s OK to leave this method blank,
or to leave it out entirely.</p>
</div>
<div class="section" id="time-limit-seconds">
<h5>time_limit_seconds()<a class="headerlink" href="#time-limit-seconds" title="Permalink to this headline">¶</a></h5>
<p>Your page can have a time limit, in which case the participant will see a countdown timer on the page.
This method lets you define what that time limit is.
If the user exceeds the time limit, they can still submit the form, but once they submit,
the <tt class="docutils literal"><span class="pre">time_limit_was_exceeded</span></tt> attribute will be set to <tt class="docutils literal"><span class="pre">True</span></tt>, which you can use to do anything you want.</p>
</div>
</div>
</div>
</div>
<div class="section" id="starttreatment">
<h2>StartTreatment<a class="headerlink" href="#starttreatment" title="Permalink to this headline">¶</a></h2>
<p>Every app needs to define a <tt class="docutils literal"><span class="pre">StartTreatment</span></tt> view that inherits from <tt class="docutils literal"><span class="pre">ptree.views.StartTreatment</span></tt>.
This view displays a welcome page to users,
followed by a &#8220;Next&#8221; button if they wish to start.
This page gives users a chance to drop out <em>before</em> we assign them to a match,
thus preventing &#8220;orphan&#8221; matches.
Behind the scenes, this view also plays an important role in initializing the database session.</p>
</div>
<div class="section" id="redemptioncode">
<h2>RedemptionCode<a class="headerlink" href="#redemptioncode" title="Permalink to this headline">¶</a></h2>
<p>Should inherit from <tt class="docutils literal"><span class="pre">ptree.views.RedemptionCode</span></tt>.</p>
<p>This view should usually be the last View in your sequence.
It tells the user how much they made,
and also gives them their redemption code.</p>
</div>
<div class="section" id="createview-templateview-sequencetemplateview-createmultipleview-updatemultipleview">
<h2>CreateView, TemplateView, SequenceTemplateView, CreateMultipleView, UpdateMultipleView<a class="headerlink" href="#createview-templateview-sequencetemplateview-createmultipleview-updatemultipleview" title="Permalink to this headline">¶</a></h2>
<p>Under development.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">views.py</a><ul>
<li><a class="reference internal" href="#updateview">UpdateView</a><ul>
<li><a class="reference internal" href="#attributes">Attributes</a><ul>
<li><a class="reference internal" href="#provided-for-you">Provided for you</a><ul>
<li><a class="reference internal" href="#participant">participant</a></li>
<li><a class="reference internal" href="#match">match</a></li>
<li><a class="reference internal" href="#treatment">treatment</a></li>
<li><a class="reference internal" href="#experiment">experiment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#required">Required</a><ul>
<li><a class="reference internal" href="#template-name">template_name</a></li>
<li><a class="reference internal" href="#form-class">form_class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">Provided for you</a><ul>
<li><a class="reference internal" href="#time-limit-was-exceeded-boolean">time_limit_was_exceeded: boolean</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#methods">Methods</a><ul>
<li><a class="reference internal" href="#optional">Optional</a><ul>
<li><a class="reference internal" href="#variables-for-template">variables_for_template()</a></li>
<li><a class="reference internal" href="#show-skip-wait">show_skip_wait()</a></li>
<li><a class="reference internal" href="#wait-message">wait_message()</a></li>
<li><a class="reference internal" href="#after-valid-form-submission">after_valid_form_submission()</a></li>
<li><a class="reference internal" href="#time-limit-seconds">time_limit_seconds()</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#starttreatment">StartTreatment</a></li>
<li><a class="reference internal" href="#redemptioncode">RedemptionCode</a></li>
<li><a class="reference internal" href="#createview-templateview-sequencetemplateview-createmultipleview-updatemultipleview">CreateView, TemplateView, SequenceTemplateView, CreateMultipleView, UpdateMultipleView</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="forms.html"
                        title="previous chapter">forms.py</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="templates.html"
                        title="next chapter">The <tt class="docutils literal"><span class="pre">templates/</span></tt> directory</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/app/views.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="templates.html" title="The templates/ directory"
             >next</a> |</li>
        <li class="right" >
          <a href="forms.html" title="forms.py"
             >previous</a> |</li>
        <li><a href="../index.html">pTree 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Writing a ptree app</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Chris Wickens.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>